/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package com.puntodeventa.mvc.Views;

import com.puntodeventa.global.Entity.Usuario;
import com.puntodeventa.global.Util.ManejaFechas;
import com.puntodeventa.global.Util.TagHelper;
import com.puntodeventa.global.Util.ValidacionForms;
import com.puntodeventa.global.printservice.printService;
import com.puntodeventa.global.report.viewer.printCompraProduct;
import com.puntodeventa.global.report.viewer.printCountVenta;
import com.puntodeventa.global.report.viewer.printVentaProduct;
import com.puntodeventa.mvc.Controller.AccesoFormsLogic;
import com.puntodeventa.mvc.Controller.UsuarioLogic;
import org.icepdf.core.exceptions.PDFSecurityException;

/**
 *
 * @author Nato
 */
public class jfrmReport extends javax.swing.JInternalFrame {

    static ValidacionForms valForm = new ValidacionForms();
    static ManejaFechas mfecha = new ManejaFechas();
    static printVentaProduct pvp = new printVentaProduct();
    static Usuario usuario;
    private String NameClass = this.getClass().getSimpleName();
    private AccesoFormsLogic accesoFormsLogic = new AccesoFormsLogic();
    private UsuarioLogic userLogic = new UsuarioLogic();

    /**
     * Creates new form jfrmReport
     */
    public jfrmReport() {
        usuario = getUser();
        this.getInitAcceso(usuario.getId_usuario());
    }

    private void getInitAcceso(int id_usuario) {
        String msj = accesoFormsLogic.getAcceso(id_usuario, NameClass);
        if (msj != null) {
            valForm.msjInfo(msj);
            dispose();
        } else {
            initComponents();
            valForm.centerFrame(this);
        }
    }

    private Usuario getUser() {
        usuario = userLogic.getUserSerializable();
        return usuario;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jpnReport = new javax.swing.JPanel();
        jlblTipoReport = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jCFecha_ini = new org.freixas.jcalendar.JCalendarCombo();
        jbtnGenerar = new javax.swing.JButton();
        jCFecha_fin = new org.freixas.jcalendar.JCalendarCombo();

        setClosable(true);

        jpnReport.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 12))); // NOI18N

        jlblTipoReport.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        jlblTipoReport.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jlblTipoReport.setText("Historial de ventas");

        jLabel2.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        jLabel2.setText("Fecha inicial");

        jLabel3.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        jLabel3.setText("       Fecha Final");

        jbtnGenerar.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        jbtnGenerar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/reportes.png"))); // NOI18N
        jbtnGenerar.setText("Generar");
        jbtnGenerar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtnGenerarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jpnReportLayout = new javax.swing.GroupLayout(jpnReport);
        jpnReport.setLayout(jpnReportLayout);
        jpnReportLayout.setHorizontalGroup(
            jpnReportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jlblTipoReport, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(jpnReportLayout.createSequentialGroup()
                .addGroup(jpnReportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jpnReportLayout.createSequentialGroup()
                        .addGroup(jpnReportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 196, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jCFecha_ini, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(jpnReportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel3, javax.swing.GroupLayout.DEFAULT_SIZE, 216, Short.MAX_VALUE)
                            .addGroup(jpnReportLayout.createSequentialGroup()
                                .addComponent(jCFecha_fin, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(0, 0, Short.MAX_VALUE))))
                    .addGroup(jpnReportLayout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(jbtnGenerar, javax.swing.GroupLayout.PREFERRED_SIZE, 137, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );
        jpnReportLayout.setVerticalGroup(
            jpnReportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jpnReportLayout.createSequentialGroup()
                .addComponent(jlblTipoReport)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 22, Short.MAX_VALUE)
                .addGroup(jpnReportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(jLabel3))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jpnReportLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jCFecha_ini, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jCFecha_fin, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jbtnGenerar))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jpnReport, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jpnReport, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jbtnGenerarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbtnGenerarActionPerformed
        try {
            /*
             * Esta validacion esta sujeta al nombre contenido del menu, asi que
             * esto no funcionara si el texto del menu se cambia, solo aplicaria
             * para el llamado a este reporte. Ver la Ventana MDI para validar
             * el llamado a esta clase
             */
            String vFechaI = mfecha.getDateCombo(jCFecha_ini);
            String vFechaF = mfecha.getDateCombo(jCFecha_fin);
            String user = usuario.getNombre();

            int vDateI = Integer.parseInt(vFechaI.replace("/", ""));
            int vDateF = Integer.parseInt(vFechaF.replace("/", ""));


            //System.out.println("Fecha inicial: " + formato.format(vDateI) + "\t Fecha final: " + formato.format(vDateF));

            if (vDateI <= vDateF) {
                if ("Historial de Venta".equals(this.getTitle())) {

                    if (true == pvp.getPrintVentaList(vFechaI, vFechaF)) {
                        System.out.println("Informe en pantalla...");
                    }
                }
                if ("Historial de Compra".equals(this.getTitle())) {
                    printCompraProduct pcp = new printCompraProduct();
                    if (true == pcp.getPrintCompraList(vFechaI, vFechaF)) {
                        System.out.println("Informe en pantalla...");
                    }
                }
                if ("Historial de Venta por Articulo".equals(this.getTitle())) {
                    printCountVenta pcv = new printCountVenta();
                    if (true == pcv.getCountVenta(vFechaI, vFechaF, usuario)) {
                        printService.printICEPdf(TagHelper.getTag("path.ventaByCategory"), "countSale.pdf");
                        valForm.msjInfo("Tome su ticket en la impresora");
                    }
                }
            } else {
                valForm.msjWarn("La Fecha Inicial no debe ser mayor a la fecha final");
            }
        } catch (NumberFormatException | PDFSecurityException ex) {
            System.out.println("Error al generar el reporte: " + ex.getMessage());
        }
    }//GEN-LAST:event_jbtnGenerarActionPerformed
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private org.freixas.jcalendar.JCalendarCombo jCFecha_fin;
    private org.freixas.jcalendar.JCalendarCombo jCFecha_ini;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JButton jbtnGenerar;
    private javax.swing.JLabel jlblTipoReport;
    private javax.swing.JPanel jpnReport;
    // End of variables declaration//GEN-END:variables

    public void setNameMenu(String nameMenu) {
        try {
            this.jlblTipoReport.setText(nameMenu);
            this.setTitle(nameMenu);
        } catch (Exception ex) {
        }
    }
}
